---
title: "FinalReport"
author: "Devi States"
date: "April 24, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Introduction
Study shows there are many factora influence life expectancy such as socioeconomic status, income, education, access to healthcare, health behaviours, poor nutrition and lack of exercise etc. In this study,there are three following research questions to be answered by using gapminder data. 

### Importing data and libraries:

```{r}
library(gapminder)
library(plyr)
library(dplyr)
library(tidyr)
library(corrplot)
library(lattice)
library(ggplot2)
library(purrr)
library(tidyverse)
library(cluster)

```
## Importing data as gapminder.csv file:   

```{r}
library(readr)
gapdata<-read_csv("../Data/gapminder.csv")

```
## Discrption of data, data wrangling and data cleaning:
- The gapminder data frames include 1704 observations and six variables:
  1. country	
  2. continent	
  3. year	
  4. lifeExp	life expectancy at birth
  5. pop	total population
  6. gdpPercap	per-capita 

### Number of observations:
```{r}
nrow(gapminder)
```

### Number of variables

```{r}
ncol(gapminder)
```

### Basic summary of statistics are shown below:

```{r}
summary(gapminder)
```

### There are not missing values

```{r}
sum(is.na(gapminder))

```

### Type of variables 

```{r}
lapply(gapminder, class)

```
###The total number of countries in the data set is shown below::
```{r}
length(levels(gapminder$country))

```

###Skewed to the left (strong right tail)

```{r}
hist(gapminder$gdpPercap,breaks = 30,main = "Figure1:Histogram of GDP Per Capita", xlab = "GDP Per Capita (Dollars)")

```

###The gapminder data frame range from 1952 to 2007

```{r}
range(gapminder$year)

```


##Dta wrangling: 
### The most ages ranges from 70.8 to 76.7 years old. 
```{r}
gapminder$lifeExpcat <- cut(gapminder$lifeExp,breaks = 10)
table(gapminder$lifeExpcat)

```

###preprocessing: 
### Data transformation to normalize gdp
```{r}
gapminder$gdpPercaplog <- log(gapminder$gdpPercap)
hist(gapminder$gdpPercaplog,breaks = 30,main = "Figure2:Histogram of log-transformed GDP Per Capita", xlab = "log of GDP Per Capita (Dollars)")

```


##Exploring data:
###Research Question 1: How does gdp relate to life expectancy for 2007?

```{r}
plot(lifeExp~gdpPercaplog,data = gapminder, main = "Life Expectancy and GDP for 2007",
xlab = "Log of GDP", ylab = "Years")
lifegdpmodel <- lm(lifeExp~gdpPercaplog,data = gapminder)
abline(lifegdpmodel, col = "red")
legend(x = "bottomright", lty = 1, col = "red", legend = "regression line")
#Figure-3
```

####
```{r}
summary(lifegdpmodel)$r.squared

```

###Research Question 2: What is life expectancy of different continent?

```{r}
ggplot(gapminder, aes(x = continent, y = lifeExp)) +
  geom_boxplot(outlier.colour = "blue") +
  geom_jitter(position = position_jitter(width = 0.1, height = 0), alpha = 0.25) 
# Figure-4
```



###Research Question 3:. What is the GDP distribution for different continents in 2007?

```{r}
GDPbyCont <- gapminder %>% 
  filter(year==2007) %>% 
  group_by(continent) %>% 
  summarize(avgGDP = mean(gdpPercap))
ggplot(GDPbyCont, 
  aes(x = continent, y = avgGDP, color = continent)) +
  geom_point(size=10) +
  ggtitle("2007 GDP by Continent") +
  xlab("Continent") + ylab("Avg. GDP per Capita") +
  theme_classic()
#Figure-5
```

###Research Question 4: What are the top 5 countries with largest GDP per capita in 2007?

```{r}
gapminder %>% filter(year==2007) %>%
  arrange(-gdpPercap) %>% 
  top_n(5)
#Table-1
```


###Research Question 5: What are the top 5 countries with higher life expetancy in 2007?

```{r}
gapminder %>% filter(year==2007) %>%
  arrange(-lifeExp) %>% 
  top_n(5)
#Table-2
```



###Exploratory plots:
####histogram, 
####correlation plot, 
####box plot (your choice of meaningful plots)

###Cluster analysis:
## Research Question 6: What is grouping in data for 2007?
```{r}
kmeansdata <- subset(gapminder,year == 2007, select = c("lifeExp","gdpPercap","pop", "country", "continent"))
summary(kmeansdata)
kmeansdata_scaled <- scale(kmeansdata[,1:3])
#Table-3

```

```{r}
library(factoextra)
fviz_nbclust(kmeansdata_scaled,kmeans,method = "wss")
Figgure-6
```


```{r}
kmeansObj <- kmeans(kmeansdata_scaled, centers=4) 
kmeansObj
#Table-4

```

```{r}
clusplot(kmeansdata_scaled,kmeansObj$cluster)
#Figure-7


```

```{r}
kmeansdata$cluster <- kmeansObj$cluster
```

####Specify explicitly the choice of # clusters using one of the learned methods (elbow, silhouette etc) 5 pts
####Visualize cluster 10 pts
####Summarize the observed pattern (if any) 5pts

###Regression analysis 20 pts
#multiple regression 1
```{r}
mreg1 <- lm(lifeExp~year+gdpPercaplog,data = gapminder)
summary(mreg1)
#Table-5
```

```{r}
par(mfrow = c(2,2))
plot(mreg1)
Figure-8
```

```{r}
ggplot(gapminder, aes(gdpPercap, lifeExp, color = year)) + 
  geom_jitter()
#Figure-9
```


```{r}
cor.test(gapminder$lifeExp, gapminder$gdpPercap)
#Table-6
```



####Specify the formula - what is your dependent variable=outcome (DV) and what are your independent variables/features (IV) 2 pts
####Provide the regression summary table 3 pts
####Explain the summary table 5 pts
####Visualize 4 diagnostic plots 5 pts
####Explain how well your model fit the assumptions based on those diagnostic plots 5 pts
####Note: Provide a full explanation/description for each figure. 
####Subtracting 1pt for not providing explanation for a figure
####Subtracting 1pt: for printing data tables. Do not include head functions, do not print a portion of dataframe - it is only needed for your exploration but not for report. Consider simply providing a descriptive information

##Visualization 5 pts (overall)
###Legends 1pt
###Title 1pt
###Axis titles 1pt
###Axis values 1pt
###Plots are readable (for example, avoid colors that are hard to distinguished, it is a good practice to know if your colors are appropriate for color blindness) 1pt

##Results and Conclusion:
Figure-1 shows most couries have lower GDP.Figure-2 demonstrats log transformation effectively normalizes the data. 
###Research Question 1: How does gdp relate to life expectancy for 2007?
Life expectancy is a very important measure when we compare the health of different countries.Figure-2 shows there are a strong corrlation between life expectancy and level of income(log of gdp). 

###Research Question 2: What is life expectancy of different continent?
###Research Question 3:. What is the GDP distribution for different continents in 2007?
###Research Question 4: What are the top 5 countries with largest GDP per capita in 2007?
###Research Question 5: What are the top 5 countries with higher life expetancy in 2007?
###Research Question 6: What is grouping in data for 2007?


###Make sure to provide answers to questions you have generated at the beginning. Write a brief summary of your answers in your report. You are not expected to have a comprehensive research in this assignment.





